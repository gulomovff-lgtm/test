# Инструкция по сборке App.jsx

## Обзор

Файл `App.jsx` был разделен на 5 частей для удобства редактирования:

- **App_Part1.jsx** - Импорты, константы, стили, утилиты
- **App_Part2.jsx** - UI компоненты
- **App_Part3.jsx** - Модальные окна
- **App_Part4.jsx** - View компоненты
- **App_Part5.jsx** - Главный компонент App с логикой

## Как собрать файл App.jsx

### Шаг 1: Создайте новый файл
```bash
touch App.jsx
```

### Шаг 2: Скопируйте части последовательно

Откройте `App.jsx` в редакторе и скопируйте содержимое файлов в следующем порядке:

1. Скопируйте всё содержимое `App_Part1.jsx`
2. Скопируйте всё содержимое `App_Part2.jsx`
3. Скопируйте всё содержимое `App_Part3.jsx`
4. Скопируйте всё содержимое `App_Part4.jsx`
5. Скопируйте всё содержимое `App_Part5.jsx`

### Шаг 3: Удалите комментарии-разделители (опционально)

Удалите все строки вида:
```javascript
// App.jsx - Part X/5
// Copy all parts sequentially into one file to use
```

и

```javascript
// ============================================
// End of Part X/5
// Continue with Part X/5
// ============================================
```

### Шаг 4: Готово!

Файл `App.jsx` готов к использованию.

## Автоматическая сборка (bash скрипт)

```bash
#!/bin/bash
# assemble.sh

cat App_Part1.jsx > App.jsx
cat App_Part2.jsx >> App.jsx
cat App_Part3.jsx >> App.jsx
cat App_Part4.jsx >> App.jsx
cat App_Part5.jsx >> App.jsx

echo "✅ App.jsx успешно собран!"
```

Запустите:
```bash
chmod +x assemble.sh
./assemble.sh
```

## Реализованные исправления

### ✅ 1. Выселение (Checkout)
- Убрана проверка `if (balance < 0)` в `handleCheckOut`
- Теперь можно выселить гостя с любым балансом (в том числе balance >= 0)

### ✅ 2. Календарь - визуальное отображение
- Для выселенных гостей используется `guest.checkOutDate` из БД вместо текущей даты
- Полоска не растягивается до сегодняшнего дня для уже выселенных гостей
- Добавлено цветовое кодирование:
  - **Зелёный** = оплаченные дни
  - **Красный** = неоплаченные дни
- Визуальное разделение пропорционально оплате

### ✅ 3. Клиенты - оптимизация
- Добавлена **пагинация**: 25 / 50 / 100 записей на страницу
- Добавлен **фильтр по странам** (dropdown с уникальными странами)
- Добавлен **поиск** по имени, паспорту, телефону
- Оптимизирован рендеринг: показываются только текущие записи страницы

### ✅ 4. Fazliddin - специальные права
- Может видеть оба хостела через переключатель
- **Hostel №1**: режим только для чтения (canEdit = false)
- **Hostel №2**: полный доступ (canEdit = true)
- Проверка `canEdit` добавлена во все кнопки действий

### ✅ 5. Исправлена печать и экспорт
- **Excel экспорт** работает через HTML table → .xls
- **Печать документов** (чек, анкета, справка) работает через window.open()
- Правильная кодировка UTF-8
- Красивое форматирование документов

## Структура файлов

### Part 1 (506 строк)
- Все импорты React и Firebase
- Константы: TRANSLATIONS, COUNTRIES, HOSTELS
- Telegram bot конфигурация
- Firebase конфигурация
- Утилиты: getTotalPaid, exportToExcel, printDocument, и др.

### Part 2 (359 строк)
- Card, Button, NavItem, Notification
- Navigation, MobileNavigation, LoginScreen
- DashboardStats, ChartsSection
- CountdownTimer, RoomCardChess

### Part 3 (977 строк)
- CheckInModal
- GuestDetailsModal
- MoveGuestModal
- ExpenseModal
- RoomFormModal
- ShiftClosingModal, ShiftBlockScreen
- ChangePasswordModal
- ClientImportModal, ClientEditModal
- CreateDebtModal

### Part 4 (1020+ строк)
- CalendarView (с исправленной визуализацией)
- ClientsView (с пагинацией и фильтрами)
- StaffView
- TaskManager
- DebtsView
- ReportsView
- ShiftsView
- ClientHistoryModal

### Part 5 (850+ строк)
- Главная функция App()
- Все хуки (useState, useEffect, useMemo)
- Обработчики событий (handleCheckIn, handleCheckOut и др.)
- Логика Fazliddin permissions
- Фильтрация данных по хостелам
- Основной JSX рендер

## Зависимости

Проект использует:
- React 18+
- Firebase 9+ (Auth, Firestore, Functions)
- Tailwind CSS (или встроенные стили)

## Установка зависимостей

```bash
npm install react react-dom
npm install firebase
npm install -D tailwindcss
```

## Запуск

```bash
npm start
```

## Примечания

- Каждый файл начинается с комментария `// App.jsx - Part X/5`
- Каждый файл заканчивается разделителем с указанием следующей части
- Все части готовы к прямому копированию без дополнительных изменений
- Вся логика сохранена без изменений, добавлены только исправления из ТЗ
- Файлы можно редактировать отдельно и затем собирать заново

## Тестирование исправлений

### Тест 1: Выселение с balance >= 0
1. Заселите гостя с полной оплатой
2. Попробуйте выселить → Должно работать ✅

### Тест 2: Календарь для выселенных гостей
1. Выселите гостя раньше даты выезда
2. Проверьте календарь → Полоска заканчивается на дате выселения, а не сегодня ✅

### Тест 3: Пагинация клиентов
1. Добавьте 100+ клиентов
2. Переключите 25/50/100 → Должно работать ✅
3. Используйте фильтр по странам → Должно работать ✅

### Тест 4: Fazliddin права
1. Войдите как fazliddin
2. Выберите Hostel №1 → Все кнопки disabled ✅
3. Выберите Hostel №2 → Все кнопки enabled ✅

### Тест 5: Печать и экспорт
1. Откройте детали гостя → Нажмите "Чек" → Должно открыться окно печати ✅
2. Откройте Отчёты → Нажмите "Экспорт в Excel" → Должен скачаться .xls файл ✅

## Поддержка

При возникновении проблем проверьте:
1. Все ли части скопированы в правильном порядке
2. Нет ли дублирующихся импортов
3. Установлены ли все зависимости
4. Правильно ли настроен Firebase

---

**Версия:** 1.0  
**Дата:** 2026-02-07  
**Автор:** GitHub Copilot Agent
